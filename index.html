<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My BookTok Shelf</title>
  <meta name="description" content="Build a dreamy BookTok bookshelf with draggable covers. Search classics, drag onto wooden shelves, save, and export as a TikTok-ready image." />
  <link rel="preconnect" href="https://covers.openlibrary.org">
  <style>
    :root{
      --bg:#f6f1ee;
      --ink:#2c2624;
      --muted:#7b6d66;
      --rose:#e7c2cf;
      --pearl:#fffbf7;
      --wood1:#b07a52;
      --wood2:#6f4b34;
      --accent:#cadcff;
      --accent-2:#d9f5e6;
      --gold:#c7a76e;
      --shadow:0 16px 44px rgba(0,0,0,.10);
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#fefefe 60%);color:var(--ink);font:16px/1.35 ui-serif, Georgia, "Times New Roman", serif;}
    header{position:sticky;top:0;z-index:5;background:linear-gradient(90deg,#fffaf7, #fff);border-bottom:1px solid #eee}
    .bar{max-width:1200px;margin:0 auto;padding:10px 16px;display:flex;gap:10px;align-items:center}
    h1{font-size:clamp(20px,3.5vw,32px);margin:0;font-weight:600;letter-spacing:0.3px}
    .pill{background:var(--pearl);border:1px solid #eadfd9;padding:8px 10px;border-radius:999px;display:flex;gap:8px;align-items:center;flex:1}
    .pill input{all:unset;flex:1; font:16px/1.2 ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial; color:#333}
    .btn{appearance:none;border:0;border-radius:12px;padding:10px 14px;background:#222;color:#fff;font-weight:600;cursor:pointer;box-shadow:0 6px 14px rgba(0,0,0,.12);transition:transform .05s ease}
    .btn:hover{transform:translateY(-1px)}
    .btn.alt{background:#fff;color:#222;border:1px solid #ddd}
    .btn.ghost{background:transparent;border:1px dashed #cbbfb7;color:#6a5a53}

    main{max-width:1200px;margin:16px auto;padding:0 16px;display:grid;grid-template-columns:340px 1fr;gap:16px}
    @media (max-width: 960px){ main{grid-template-columns:1fr} }

    /* Left panel: search & results */
    .panel{background:linear-gradient(180deg,#fff, #fffaf8);border:1px solid #eee;border-radius:20px;overflow:hidden;box-shadow:0 10px 24px rgba(0,0,0,.05)}
    .panel h2{font-size:18px;margin:0;padding:14px 16px;border-bottom:1px solid #f0e8e3;background:linear-gradient(90deg, #fff, #fff7f2)}
    .panel .content{padding:14px 12px}

    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:10px}
    .chip{padding:6px 10px;border-radius:999px;border:1px solid #e7ddd7;background:#fff;color:#4a3f39;cursor:pointer;font: 13px/1 ui-sans-serif, system-ui;}
    .chip:hover{background:#fff4fa}

    .results{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    @media (max-width: 480px){ .results{grid-template-columns:repeat(2,1fr)} }
    .book-card{position:relative;border-radius:12px;overflow:hidden;background:#f5f1ee;border:1px solid #e9dfd8;display:flex;align-items:center;justify-content:center;cursor:grab;min-height:170px}
    .book-card img{width:100%;height:100%;object-fit:cover;display:block}
    .book-card .ttl{position:absolute;inset:auto 6px 6px 6px;background:linear-gradient(180deg,rgba(0,0,0,.0), rgba(0,0,0,.55));color:#fff;padding:6px 8px;border-radius:8px;font:12px/1.2 ui-sans-serif, system-ui}

    /* Shelf area */
    .workspace{display:flex;flex-direction:column;gap:12px}
    .canvas-wrap{background:radial-gradient(1000px 500px at 70% 10%, #fff, #fff4f0 60%, #ffece2);border:1px solid #eee;border-radius:22px;overflow:hidden;box-shadow:0 16px 40px rgba(0,0,0,.09);}
    .toolbar{display:flex;flex-wrap:wrap;gap:8px;padding:12px;border-bottom:1px solid #efe6e0;background:linear-gradient(90deg,#fff,#fff9f6)}

    /* TikTok 1080x1920 safe board */
    .board-outer{display:flex;justify-content:center;align-items:center;padding:16px}
    .board{position:relative;width:360px;height:640px;border-radius:22px;background:radial-gradient(80% 50% at 50% 0%, #fff 0%, #fff6 50%, #f9efe7 100%), linear-gradient(180deg,#f6ebe3,#fffdfa);box-shadow: inset 0 0 0 1px #ead8cf, inset 0 30px 80px rgba(190,150,120,.25), var(--shadow); overflow:hidden}
    @media (min-width:1024px){ .board{width:540px;height:960px} }
    @media (min-width:1024px){ .board{width:540px;height:960px} }

    .room-bg{position:absolute;inset:0;background:
      radial-gradient(120% 70% at 50% -10%, rgba(202,220,255,.35), transparent 60%),
      radial-gradient(80% 40% at 10% 20%, rgba(217,245,230,.35), transparent 60%),
      radial-gradient(80% 40% at 90% 20%, rgba(255,223,237,.35), transparent 60%);
      filter: none;
    }

    .titleplate{position:absolute;top:16px;left:50%;transform:translateX(-50%);font-weight:700;color:#3a2e2a;background:linear-gradient(180deg,#fff8,#fff0);backdrop-filter: blur(3px);padding:10px 18px;border-radius:999px;border:1px solid #ead8cf;box-shadow:0 10px 22px rgba(0,0,0,.08)}

    .shelf{position:absolute;left:10px;right:10px;height:92px;border-radius:10px;background:
      linear-gradient(180deg, var(--wood1), var(--wood2));
      box-shadow:0 10px 22px rgba(0,0,0,.28), inset 0 2px 0 rgba(255,255,255,.25);
      border:1px solid rgba(0,0,0,.25);
    }
    .shelf::before{content:"";position:absolute;inset:6px;top:auto;height:10px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,.25),rgba(0,0,0,.05));mix-blend-mode:soft-light}
    .shelf::after{content:"";position:absolute;left:-6px;right:-6px;bottom:-10px;height:12px;border-radius:10px;background:rgba(0,0,0,.18);filter:blur(8px
    .shelf::after{content:"";position:absolute;left:-6px;right:-6px;bottom:-10px;height:12px;border-radius:10px;background:rgba(0,0,0,.15);filter:blur(8px);}
    .shelf:nth-child(1){top:80px}
    .shelf:nth-child(2){top:210px}
    .shelf:nth-child(3){top:340px}
    .shelf:nth-child(4){top:470px}

    .book{position:absolute;bottom:8px;width:58px;height:80px;border-radius:4px;box-shadow:0 8px 14px rgba(0,0,0,.25);transform:rotate(var(--rot, -0.5deg));transform-origin:bottom center;cursor:grab;user-select:none;}
    .book img{width:100%;height:100%;object-fit:cover;border-radius:4px}

    .badge{position:absolute;bottom:8px;right:8px;background:rgba(255,255,255,.9);color:#3a2e2a;border:1px solid #eadfdb;font:11px/1.2 ui-sans-serif, system-ui;padding:4px 8px;border-radius:999px;box-shadow:0 4px 10px rgba(0,0,0,.08)}

    .footer-note{padding:10px 12px;color:#7a6d66;font-size:12px}

    .note{font:12px/1.2 ui-sans-serif, system-ui;color:#6b5c55}
    .row{display:flex;gap:8px;align-items:center;margin:8px 0}
    .spacer{flex:1}
  </style>
</head>
<body>
<header>
  <div class="bar">
    <h1>✨ BookTok Aesthetic Bookshelf</h1>
    <div class="pill" style="max-width:560px">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 21l-4.3-4.3" stroke="#7b6d66" stroke-width="1.6" stroke-linecap="round"/><circle cx="11" cy="11" r="7" stroke="#7b6d66" stroke-width="1.6" fill="none"/></svg>
      <input id="q" placeholder="Search public‑domain classics (e.g., pride and prejudice)"/>
      <button class="btn alt" id="go">Search</button>
    </div>
    <button class="btn" id="export">Export PNG</button>
  </div>
</header>

<main>
  <section class="panel" aria-label="Search and picks">
    <h2>Discover Classics</h2>
    <div class="content">
      <div class="chips" id="chips"></div>
      <div class="results" id="results" aria-live="polite"></div>
    </div>
  </section>

  <section class="workspace">
    <div class="canvas-wrap">
      <div class="toolbar">
        <button class="btn ghost" id="clear">Clear shelf</button>
        <button class="btn ghost" id="save">Save</button>
        <button class="btn ghost" id="load">Load</button>
        <div class="spacer"></div>
        <span class="note">Drag covers from the left onto a shelf. Tap a book to tilt. Long‑press to remove.</span>
      </div>
      <div class="board-outer">
        <div class="board" id="board">
          <div class="room-bg"></div>
          <div class="titleplate">My BookTok Shelf</div>
          <div class="shelf" data-shelf="1"></div>
          <div class="shelf" data-shelf="2"></div>
          <div class="shelf" data-shelf="3"></div>
          <div class="shelf" data-shelf="4"></div>
          <div class="badge">#BookTok • Public Domain</div>
        </div>
      </div>
    </div>
    <div class="footer-note">Covers are fetched via Open Library Covers API for public‑domain classics; you can replace any with Standard Ebooks cover art if you prefer their typography. This site doesn’t host copyrighted images.</div>
  </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
// --- Tiny utility kit ---
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const resultsEl = $('#results');
const chipsEl = $('#chips');
const board = $('#board');

// Prefill vibe chips (BookTok-friendly quick searches)
const presetQueries = [
  'pride and prejudice', 'jane eyre', 'wuthering heights',
  'dracula', 'frankenstein', 'the picture of dorian gray',
  'the count of monte cristo', 'les miserables', 'little women',
  'the secret garden', 'emma jane austen', 'the odyssey', 'a tale of two cities',
];

function renderChips(){
  chipsEl.innerHTML = '';
  presetQueries.forEach(q => {
    const chip = document.createElement('button');
    chip.className = 'chip';
    chip.textContent = q;
    chip.addEventListener('click', () => doSearch(q));
    chipsEl.appendChild(chip);
  });
}

async function doSearch(query){
  $('#q').value = query;
  resultsEl.innerHTML = '<div class="note" style="grid-column:1/-1">Searching…</div>';
  try{
    const url = `https://openlibrary.org/search.json?q=${encodeURIComponent(query)}&limit=18`;
    const res = await fetch(url);
    const data = await res.json();
    const docs = data.docs || [];
    if(!docs.length){
      resultsEl.innerHTML = '<div class="note" style="grid-column:1/-1">No results. Try another classic.</div>';
      return;
    }
    resultsEl.innerHTML = '';
    docs.forEach(d => {
      const coverId = d.cover_i;
      const title = d.title || 'Untitled';
      const author = (d.author_name && d.author_name[0]) || '';
      let img = coverId ? `https://covers.openlibrary.org/b/id/${coverId}-L.jpg` : '';
      const card = document.createElement('div');
      card.className = 'book-card';
      card.draggable = true;
      card.dataset.title = title;
      card.dataset.author = author;
      card.dataset.src = img;
      card.addEventListener('dragstart', e => {
        e.dataTransfer.setData('text/plain', JSON.stringify({title, author, src: img}));
      });
      if(img){
        const im = new Image();
        im.src = img;
        im.alt = `${title} — ${author}`;
        im.loading = 'lazy';
        card.appendChild(im);
      } else {
        card.innerHTML = `<div class="ttl">${title}</div>`;
      }
      const ttl = document.createElement('div');
      ttl.className = 'ttl';
      ttl.textContent = `${title}${author? ' — ' + author: ''}`;
      card.appendChild(ttl);
      resultsEl.appendChild(card);
    });
  }catch(err){
    console.error(err);
    resultsEl.innerHTML = '<div class="note" style="grid-column:1/-1">Search error. Please try again.</div>';
  }
}

// Drag targets: shelves
$$('.shelf').forEach(shelf => {
  shelf.addEventListener('dragover', e => e.preventDefault());
  shelf.addEventListener('drop', e => {
    e.preventDefault();
    try{
      const data = JSON.parse(e.dataTransfer.getData('text/plain'));
      const x = e.offsetX; // position relative to shelf
      placeBookOnShelf(shelf, data, x);
      persist();
    }catch(err){ console.warn('drop parse err', err); }
  });
});

const rand = (a,b)=> a + Math.random()*(b-a);

function placeBookOnShelf(shelf, {title, author, src}, x){
  const el = document.createElement('div');
  el.className='book';
  el.style.left = Math.max(6, Math.min((shelf.clientWidth-70), x-30)) + 'px';
  el.style.setProperty('--rot', (Math.random() < .5 ? -1:1) * rand(0,1.2) + 'deg');
  el.dataset.title = title; el.dataset.author = author; el.dataset.src = src || '';

  const img = new Image();
  img.src = src || placeholderCover(title, author);
  img.alt = `${title} — ${author}`;
  el.appendChild(img);

  // Click to tilt slightly
  el.addEventListener('click', () => {
    const current = parseFloat((getComputedStyle(el).getPropertyValue('--rot')||'0deg').replace('deg',''));
    const next = Math.abs(current) < 0.2 ? rand(-1.5,1.5) : -current * 0.9;
    el.style.setProperty('--rot', next + 'deg');
  });
  // Long press to remove
  let pressTimer;
  el.addEventListener('pointerdown', ()=>{ pressTimer=setTimeout(()=>{ el.remove(); persist(); }, 600) });
  ['pointerup','pointerleave'].forEach(ev=> el.addEventListener(ev, ()=> clearTimeout(pressTimer)));

  shelf.appendChild(el);
}

function placeholderCover(title, author){
  // Fallback SVG data URL with pretty gradient and text
  const bg1 = '#d8ecff', bg2='#ffe1ea';
  const t = (title||'Untitled').slice(0,36).replace(/&/g,'&amp;');
  const a = (author||'').slice(0,28).replace(/&/g,'&amp;');
  const svg = `\n    <svg xmlns='http://www.w3.org/2000/svg' width='400' height='550'>\n      <defs>\n        <linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>\n          <stop offset='0%' stop-color='${bg1}'/>\n          <stop offset='100%' stop-color='${bg2}'/>\n        </linearGradient>\n      </defs>\n      <rect width='100%' height='100%' fill='url(#g)'/>\n      <rect x='18' y='18' width='364' height='514' rx='14' fill='rgba(255,255,255,.4)' stroke='rgba(0,0,0,.06)'/>\n      <text x='36' y='280' font-family='Georgia,serif' font-size='28' fill='#2b2a2a'>${t}</text>\n      <text x='36' y='318' font-family='Georgia,serif' font-size='16' fill='#5a5552'>${a}</text>\n    </svg>`;
  return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
}

// Export PNG of the board
$('#export').addEventListener('click', async ()=>{
  const node = board;
  // Temporarily bump resolution
  const scale = window.devicePixelRatio > 1 ? 2 : 2;
  const canvas = await html2canvas(node, {scale, backgroundColor: null});
  const url = canvas.toDataURL('image/png');
  const a = document.createElement('a');
  a.href = url;
  a.download = 'my-booktok-shelf.png';
  a.click();
});

// Clear / save / load
$('#clear').addEventListener('click', ()=>{ $$('.book').forEach(b => b.remove()); persist(); });
$('#save').addEventListener('click', ()=>{ persist(true); alert('Shelf saved!'); });
$('#load').addEventListener('click', ()=>{ restore(); });

function persist(silent){
  const all = [];
  $$('.shelf').forEach((shelf, idx)=>{
    shelf.querySelectorAll('.book').forEach(b => {
      all.push({
        shelf: idx,
        left: parseFloat(b.style.left),
        rot: getComputedStyle(b).getPropertyValue('--rot'),
        title: b.dataset.title, author: b.dataset.author, src: b.dataset.src
      });
    });
  });
  localStorage.setItem('booktok-shelf', JSON.stringify(all));
}

function restore(){
  $$('.book').forEach(b => b.remove());
  const all = JSON.parse(localStorage.getItem('booktok-shelf')||'[]');
  const shelves = $$('.shelf');
  all.forEach(it => {
    const shelf = shelves[it.shelf] || shelves[0];
    placeBookOnShelf(shelf, it, (it.left||20)+30);
    const last = shelf.lastElementChild;
    if(last) last.style.setProperty('--rot', it.rot||'-0.5deg');
  });
}

// Search events
$('#go').addEventListener('click', ()=> doSearch($('#q').value || 'pride and prejudice'));
$('#q').addEventListener('keydown', e=>{ if(e.key==='Enter') $('#go').click(); });

renderChips();
restore();
// Auto-run a cozy default
doSearch('pride and prejudice');
</script>
</body>
</html>
